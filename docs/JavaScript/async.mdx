---
title: 'Async'
---

import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

## Basics

```js
// Await
async function asyncCall() {
  try {
    const result = await oneSec(1)
    console.log(result)
  } catch (err) {
    console.log(err)
  }
}

// Promise
// Thông thường .then() chỉ cần 1 param - fn `resolve` là đủ
// ko cần param thứ 2 - fn `reject`, trừ những lỗi phải dc xử lý ngay lập tức.
// `resolveValue` ở đây là hàm `setTimeout` - xem bên dưới
oneSec(2)
  .then(
    (resolveValue) => console.log(resolveValue),
    // ,(rejectValue) => { doing something to deal with the error immediately }
  )
  .catch((err) => console.log(err.name, err.message))
```

## `Promise` explain

```js
// Async function always return a promise. If not, it will be wrapped in a Promise
async function foo() {
  return 1
} // Equalivent to this. Note that this doesn't have `async` keyword
function foo2() {
  return Promise.resolve(1)
}

function oneSec(a) {
  return new Promise((resolve, reject) => {
    // `resolve`/ `reject` is called when it was succesful/failed
    if (a === 1) setTimeout(() => resolve('Ok bro'), 1000)
    else reject(new RangeError('Lỗi: a !== 1'))
  })
}
```

## `Promise` methods

```js
// All must fullfill
Promise.all([oneSec, twoSecs]).then((messages) => {
  console.log(messages) // ["oneSec", "twoSecs"]
})

// All must settle (fulfilled or rejected)
// [{ status: "fulfilled", value: "oneSec" }, { status: "fulfilled", value: "twoSecs" }]
Promise.allSettled([oneSec, twoSecs]).then((messages) => {
  console.log(messages)
})

Promise.race([oneSec, twoSecs]).then((message) => {
  console.log(message) // oneSec - whatever settles first
})

Promise.any([oneSec, twoSecs]).then((firstMessage) => {
  console.log(firstMessage) // oneSec - whatever fulfills first
})
```

## Axios vs Fetch

Fetch phải tốn thêm 1 lần `.json()`, ngoài ra trong các lệnh như POST, PATCH,... phải convert data bằng `JSON.stringify`. Fetch thì phải check `response.ok` rồi mới `catch` error còn Axios thì `catch` trực tiếp luôn.

<Tabs>
  <TabItem value="POST" label="POST">

```js
fetch('https://jsonplaceholder.typicode.com/posts', {
  method: 'POST',
  headers: {
    'Content-type': 'application/json', // `fetch` default is 'text/plain'
    // axios default is 'application/json'
  },
  body: JSON.stringify({
    email: '@gmail.com',
  }),
})
  .then((res) => {
    if (!res.ok) throw new Error(res.status)
    return res.json()
  })
  .then((data) => console.log(data))
  .catch((err) => console.log(err))

axios
  .post('https://jsonplaceholder.typicode.com/posts', {
    email: '@gmail.com',
  })
  .then((res) => console.log(res.data))
  .catch((error) => console.log(error))
```

  </TabItem>
  
  <TabItem value="GET" label="GET">

```js
fetch('https://jsonplaceholder.typicode.com/todos/1')
  .then((res) => res.json())
  .then((res) => {
    if (!res.ok) throw new Error(res.status)
    return res.json()
  })
  .then((data) => console.log(data))
  .catch((err) => console.log(err))

axios
  .get('https://jsonplaceholder.typicode.com/todos/1')
  .then((res) => console.log(res.data))
  .catch((err) => console.log(err))
```

  </TabItem>

  <TabItem value="PUT" label="PUT">

```js
// Replace a resource
fetch('https://jsonplaceholder.typicode.com/posts/1', {
  method: 'PUT',
  body: JSON.stringify({
    id: 1,
    title: 'foo',
    body: 'bar',
    userId: 1,
  }),
  headers: {
    'Content-type': 'application/json; charset=UTF-8',
  },
})
  .then((res) => res.json())
  .then((data) => console.log(data))
```

  </TabItem>

  <TabItem value="PATCH" label="PATCH">

```js
// Modify a resource thay vì replace như PUT
fetch('https://jsonplaceholder.typicode.com/posts/1', {
  method: 'PATCH',
  body: JSON.stringify({
    title: 'Vip pro',
  }),
  headers: {
    'Content-type': 'application/json; charset=UTF-8',
  },
})
  .then((res) => res.json())
  .then((data) => console.log(data))
```

  </TabItem>

  <TabItem value="Concurrent" label="Concurrent">

```js
Promise.all([
  fetch('https://jsonplaceholder.typicode.com/posts/1'),
  fetch('https://jsonplaceholder.typicode.com/posts/2'),
]).then((responses) =>
  responses.forEach(async (res) => {
    const data = await res.json()
    console.log(data)
  }),
)

Promise.all([
  axios.get('https://jsonplaceholder.typicode.com/posts/1'),
  axios.get('https://jsonplaceholder.typicode.com/posts/2'),
]).then((responses) => responses.forEach((res) => console.log(res.data)))
```

  </TabItem>

</Tabs>
